package de.stroehmi.diving.zhl16c.algorithm
/**
 * List of all CNS toxitity levels.
 *
 * @property elements
 */
internal class CnsList(private val elements : Array<Cns>) {
    /**
     * Finds best match (safe upper) CNS toxitity level based on partial inspiratory pressure of oxygen.
     *
     * @param partialInspiratoryPressureOxygen Partial inspiratory pressure of oxygen.
     */
    private fun find(partialInspiratoryPressureOxygen: Double) = elements.find { elem -> elem.partialPressureOxygen > partialInspiratoryPressureOxygen } ?: elements[elements.lastIndex]
    /**
     * Calculates CNS toxitiy percentage.
     *
     * @param partialInspiratoryPressureOxygen Partial inspiratory pressure of oxygen.
     * @param duration Exposure time in minutes.
     */
    fun calculateCnsPercentage(partialInspiratoryPressureOxygen : Double, duration: Double) = find(partialInspiratoryPressureOxygen = partialInspiratoryPressureOxygen).cnsPercentPerMinute * duration

    companion object Factory {
        private val partialInspiratoryPressureOxygen: ArrayList<Double> = arrayListOf(
            0.50,
            0.60,
            0.64,
            0.66,
            0.68,
            0.70,
            0.74,
            0.76,
            0.78,
            0.80,
            0.82,
            0.84,
            0.86,
            0.88,
            0.90,
            0.92,
            0.94,
            0.96,
            0.98,
            1.00,
            1.02,
            1.04,
            1.06,
            1.08,
            1.10,
            1.12,
            1.14,
            1.16,
            1.18,
            1.20,
            1.22,
            1.24,
            1.26,
            1.28,
            1.30,
            1.32,
            1.34,
            1.36,
            1.38,
            1.40,
            1.42,
            1.44,
            1.46,
            1.48,
            1.50,
            1.52,
            1.54,
            1.56,
            1.58,
            1.60,
            1.62,
            1.65,
            1.67,
            1.70,
            1.72,
            1.74,
            1.77,
            1.79,
            1.80,
            1.82,
        )
        private val cnsPercentPerMinute: ArrayList<Double> = arrayListOf(
            0.00,
            0.14,
            0.15,
            0.16,
            0.17,
            0.18,
            0.19,
            0.2,
            0.21,
            0.22,
            0.23,
            0.24,
            0.25,
            0.26,
            0.28,
            0.29,
            0.3,
            0.31,
            0.32,
            0.33,
            0.35,
            0.36,
            0.38,
            0.4,
            0.42,
            0.43,
            0.43,
            0.44,
            0.46,
            0.47,
            0.48,
            0.51,
            0.52,
            0.54,
            0.56,
            0.57,
            0.6,
            0.62,
            0.63,
            0.65,
            0.68,
            0.71,
            0.74,
            0.78,
            0.83,
            0.93,
            1.04,
            1.19,
            1.47,
            2.22,
            5.00,
            6.25,
            7.69,
            10.00,
            12.5,
            20.00,
            25.00,
            31.25,
            50.00,
            100.00,
        )
        private val maximumDurationInMinutes: ArrayList<Int> = arrayListOf(
            Int.MAX_VALUE,
            714,
            667,
            625,
            588,
            556,
            526,
            500,
            476,
            455,
            435,
            417,
            400,
            385,
            357,
            345,
            333,
            323,
            313,
            303,
            286,
            278,
            263,
            250,
            238,
            233,
            233,
            227,
            217,
            213,
            208,
            196,
            192,
            185,
            179,
            175,
            167,
            161,
            159,
            154,
            147,
            141,
            135,
            128,
            120,
            108,
            96,
            84,
            68,
            45,
            20,
            16,
            13,
            10,
            8,
            5,
            4,
            3,
            2,
            1
        )
        fun create() = CnsList(Array(partialInspiratoryPressureOxygen.size) { no -> Cns(partialPressureOxygen = partialInspiratoryPressureOxygen[no], cnsPercentPerMinute = cnsPercentPerMinute[no], maximumDurationInMinutes = maximumDurationInMinutes[no]) })
    }
}